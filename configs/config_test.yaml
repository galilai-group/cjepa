# Test/Evaluation Configuration for VideoWM
# This config is used for evaluating a trained world model checkpoint

defaults:
  - _self_
  - override hydra/hydra_logging: disabled
  - override hydra/job_logging: disabled

hydra:
  output_subdir: null

# Dataset configuration (use validation or test split)
dataset_name: clevrer
cache_dir: "/users/hnam16/scratch/.stable_worldmodel"
training_type: video # options: video, wm

# For evaluation 
num_batches: 50
rollout_batches: 10
collision_tolerance: 1

checkpoint_path: null

# Videosaur model config for DINO encoder
videosaur:
  NUM_SLOTS: 7
  SLOT_DIM: 64
  DINO_MODEL: vit_small_patch14_dinov2.lvd142m
  FEAT_DIM: 384
  NUM_PATCHES: 196

# Model configuration for building DINO encoder
model:
  load_weights: null  # Will use pretrained weights automatically
  modules_to_load: null

# Model architecture must match training configuration
image_size: 224
patch_size: 16
train_split: 0.8

# Same dinowm configuration as training
dinowm:
  history_size: 3
  num_preds: 1
  proprio_dim: 4
  proprio_embed_dim: 10
  action_dim: 2
  action_embed_dim: 10

predictor:
  depth: 6
  heads: 16
  mlp_dim: 2048
  dim_head: 64
  dropout: 0.1
  emb_dropout: 0.0

# Evaluation parameters
batch_size: 32
num_workers: 8
seed: 42



n_steps:  ${eval:'${dinowm.num_preds} + ${dinowm.history_size}'}
frameskip: 5

# Metrics to compute
metrics:
  rankme:
    enabled: true
    min_batch_size: 512  # Accumulate embeddings across batches
  effective_rank:
    enabled: false
  frechet_joint_distance:
    enabled: true
    reduce_dim: 64  # Dimension for PCA reduction (null to skip, or integer like 64, 128)
  feature_rollout_degradation:
    enabled: false
    num_rollout_steps: 5


visualization:
  enabled: false
  # Phase Space Plot: State Norm vs Temporal Derivative
  phase_space:
    enabled: true
    # Interpretation: Small loops=stable states, Excursions=interactions



# Output
output_dir: "./eval_results"
save_embeddings: false  # Set to true to save all embeddings for analysis
visualization_dir: null  # If null, defaults to output_dir/visualizations
